
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>chef - Jordan Rogers-Smith</title>
	<meta name="author" content="Jordan Rogers-Smith">

	
	<meta name="description" content="">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Jordan Rogers-Smith" type="application/atom+xml">
	
	<link rel="canonical" href="http://jordanrs.github.io/blog/2013/05/26/chef/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("jordanrs2k1@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Jordan Rogers-Smith</a></h1>
  
    <h2>Coding away day to day.</h2>
  
</hgroup>


<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/JRogersSmith" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/jordanrs" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Chef</h1>
	<div class="entry-content" itemprop="articleBody"><p>get a bootstrap cehf-repository from</p>

<p><a href="http://github.com/opscode/chef-repo/tarball/master">http://github.com/opscode/chef-repo/tarball/master</a></p>

<p>and in a .chef folder which has your shared keys, your user keys and your organistion validator key and your knife.rb</p>

<p>Hosted chef server</p>

<p><a href="http://www.agileweboperations.com/amazon-ec2-instances-with-opscode-chef-using-knife">http://www.agileweboperations.com/amazon-ec2-instances-with-opscode-chef-using-knife</a></p>

<p><a href="http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide">http://wiki.opscode.com/display/chef/EC2+Bootstrap+Fast+Start+Guide</a></p>

<p>assusme defaults -G &lsquo;default&rsquo; no roles or recipes and will boostrap chef client and ruby on teh server make sure port 22 80 and 443 are open on the server</p>

<p>knife ec2 server create -I ami-7962730d -f t1.micro -S knife -i ~/.ssh/knife.pem &mdash;ssh-user ubuntu &mdash;region eu-west-1 -Z eu-west-1a</p>

<p>add the knife.pem to your ssh agent
ssh-add ~/.ssh/knife.pem</p>

<p>means you can remove the -i ~/.ssh/knife.pem from the command</p>

<p>knife ec2 server create -I ami-7962730d -f t1.micro -S knife &mdash;ssh-user ubuntu &mdash;region eu-west-1 -Z eu-west-1a</p>

<p>knife[:aws_ssh_key_id] = &ldquo;knife&rdquo;</p>

<p>knife ec2 server create -I ami-7962730d -f t1.micro &mdash;ssh-user ubuntu &mdash;region eu-west-1 -Z eu-west-1a</p>

<p>knife[:availability_zone]     = &lsquo;eu-west-1a&rsquo;
knife[:region]                = &lsquo;eu-west-1&rsquo;</p>

<p>knife ec2 server create -I ami-7962730d -f t1.micro &mdash;ssh-user ubuntu</p>

<p>this will create our instance, install chek-client on the server and assocatie the client with the hosted chef server. and will run any recipes or roles we defined. but since we didnt define anything we will have to do this late</p>

<p>so now we have a node / client from out chef server we can begin building up out cookbooks to install our software.</p>

<p>to manage out cookbooks and first gem install berkshelf which is to cookbooks as bundler is to gems</p>

<p>Figure out what software you want on your in this case it is ruby, bundler, nodejs, postgres and nginx</p>

<p>berks upload moves our files to our chef server</p>

<p>rake install &ndash; updates the cookbooks and roles</p>

<p>knife ssh name:i-e41aa4a9 -x ubuntu &ldquo;sudo chef-client&rdquo; this tells our chef client (the server we are configuring) to update its self from the server</p>

<p><a href="http://docs.opscode.com/chef_client.html">http://docs.opscode.com/chef_client.html</a> how to set chef-client up to run as a deamon that by default gets called every</p>

<p>So some cook books wont have a recipe, so how do we get to use them in cookbook</p>

<p>like applciation and application_ruby both have no recipes so we create a new cook book and recipe that dpends on these cook books</p>

<p>depends &ldquo;application&rdquo;
depends &ldquo;application_ruby&rdquo;</p>

<p>when create a server with knife we define it a role such as webserver, we than create a role and define a run list which is the order things will be installed in by chef</p>

<p>name &ldquo;webserver&rdquo;
description &ldquo;basic example&rdquo;
run_list(
  &ldquo;recipe[apt]&rdquo;,
  &ldquo;recipe[build-essential]&rdquo;,
  &ldquo;recipe[nginx]&rdquo;,
  &ldquo;recipe[ruby_build]&rdquo;,
  &ldquo;recipe[example]&rdquo;
)</p>

<p>at the bottom we have our</p>

<p>since we didnt spcify a role when the server was created we can chage this by doing knife node list &ndash; get the identifier and then knife node edit <identifer>  at the bottom</p>

<p>&ldquo;run_list&rdquo;: [
  &ldquo;role[webserver]&rdquo;
]</p>

<p>now when ever we run sudo chef-client configures this as the webserver role</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Jordan Rogers-Smith -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'jordanrs-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






		</div>
	</div>
</body>
</html>
