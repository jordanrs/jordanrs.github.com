
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Learning Chef From Scratch - Building a EC2 backed Rails Stack Part 2 - Jordan Rogers-Smith</title>
	<meta name="author" content="Jordan Rogers-Smith">

	
	<meta name="description" content="Setting up our Cookbooks and Recipes">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Jordan Rogers-Smith" type="application/atom+xml">
	
	<link rel="canonical" href="http://jordanrs.github.io/blog/2013/06/18/learning-chef-from-scratch-building-a-ec2-backed-rails-stack-part-2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("jordanrs2k1@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Jordan Rogers-Smith</a></h1>
  
    <h2>Coding away day to day.</h2>
  
</hgroup>


<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/JRogersSmith" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/jordanrs" title="GitHub">GitHub</a>
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/jordanrogerssmith">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Learning Chef From Scratch - Building a EC2 Backed Rails Stack Part 2</h1>
	<h2 class="sub_heading" itemprop="name">Setting up our Cookbooks and Recipes</h2>
	<div class="entry-content" itemprop="articleBody"><p>To manage our cookbooks and first gem install berkshelf <a href="berkshelf">!! LINK BERKSHELF!!</a> this is to cookbooks what bundler is to gems. So do <code>gem install bershelf</code> then run berks init in our chef-repo route to create a Berkshelf file. Once you know what software you wish to install, find the relevant cookbooks on <a href="">OPSCODE SITE LINK</a> and add the them to your Berks file. Berkshelf docs are very through in what you can do with it so its worth reading.</p>

<p>Once you have the cook books you want in your Berksfile run <code>berks install</code> to install them. Like gems they are stored away from the project so dont eb surpriesd that our cookboks fodler is still empty.</p>

<p>and finally do <code>berks upload</code> to have our cookbooks uploaded to our chef server so they are available to any of the clients later on.</p>

<h1>Setting up a role</h1>

<h1>Creating our first Cookbook</h1>

<h1>Writing a recipe</h1>

<h1>Turning our instance into its role</h1>

<p>The most important thing i think to understand about chef is that it is IDEPOATENST. That is, if a command has been run once and was successfull, it should not be run again. Its worth bearing this in mind while writing recipies and why its useful to get familiar with Chefs or another Cookbooks DSL</p>

<p>rake install &ndash; updates the cookbooks and roles</p>

<p>knife ssh name:i-2853dd65 -x ubuntu &ldquo;sudo chef-client&rdquo; this tells our chef client (the server we are configuring) to update its self from the server</p>

<p><a href="http://docs.opscode.com/chef_client.html">http://docs.opscode.com/chef_client.html</a> how to set chef-client up to run as a deamon that by default gets called every</p>

<p>So some cook books wont have a recipe, so how do we get to use them in cookbook</p>

<p>like applciation and application_ruby both have no recipes so we create a new cook book and recipe that dpends on these cook books</p>

<pre><code>depends "application"
depends "application_ruby"
</code></pre>

<p>INCLUDE FILES FROM REPO AND HEAVILY COMMENT THEM</p>

<p>when create a server with knife we define it a role such as webserver, we than create a role and define a run list which is the order things will be installed in by chef</p>

<pre><code>name "webserver"
description "basic example"
run_list(
  "recipe[apt]",
  "recipe[build-essential]",
  "recipe[nginx]",
  "recipe[ruby_build]",
  "recipe[example]"
)
</code></pre>

<p>we can also override the default attributes of any of these cook books</p>

<p>at the bottom we have our</p>

<p>since we didnt spcify a role when the server was created we can chage this by doing knife node list &ndash; get the identifier and then knife node edit <identifer>  at the bottom</p>

<p>&ldquo;run_list&rdquo;: [
  &ldquo;role[webserver]&rdquo;
]</p>

<p>now when ever we run sudo chef-client configures this as the webserver role</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Jordan Rogers-Smith -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'jordanrs-blog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://jordanrs.github.io/blog/2013/06/18/learning-chef-from-scratch-building-a-ec2-backed-rails-stack-part-2/';
        var disqus_url = 'http://jordanrs.github.io/blog/2013/06/18/learning-chef-from-scratch-building-a-ec2-backed-rails-stack-part-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






		</div>
	</div>
</body>
</html>
