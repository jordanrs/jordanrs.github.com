
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Jordan Rogers-Smith</title>
	<meta name="author" content="Jordan Rogers-Smith">

	
	<meta name="description" content="Apr 30th, 2014 postgres Quick Way to Join Across Two Databases Left align Right align Center align This This This column column column will will &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Jordan Rogers-Smith" type="application/atom+xml">
	
	<link rel="canonical" href="http://jordanrs.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("jordanrs2k1@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
</div>
<hgroup>
  <h1><a href="/">Jordan Rogers-Smith</a></h1>
  
    <h2>Coding away day to day.</h2>
  
</hgroup>


<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/JRogersSmith" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/jordanrs" title="GitHub">GitHub</a>
		
		
		
		<a class="linkedin" href="http://www.linkedin.com/in/jordanrogerssmith">LinkedIn</a>
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-04-30T17:54:00+01:00" data-updated="true" itemprop="datePublished">Apr 30<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/postgres/'>postgres</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/04/30/dblink/" itemprop="url">Quick Way to Join Across Two Databases</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<table>
<thead>
<tr>
<th></th>
<th align="left"> Left align </th>
<th align="right"> Right align </th>
<th align="center"> Center align </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td align="left"> This       </td>
<td align="right">        This </td>
<td align="center">     This     </td>
</tr>
<tr>
<td></td>
<td align="left"> column     </td>
<td align="right">      column </td>
<td align="center">    column    </td>
</tr>
<tr>
<td></td>
<td align="left"> will       </td>
<td align="right">        will </td>
<td align="center">     will     </td>
</tr>
<tr>
<td></td>
<td align="left"> be         </td>
<td align="right">          be </td>
<td align="center">      be      </td>
</tr>
<tr>
<td></td>
<td align="left"> left       </td>
<td align="right">       right </td>
<td align="center">    center    </td>
</tr>
<tr>
<td></td>
<td align="left"> aligned    </td>
<td align="right">     aligned </td>
<td align="center">   aligned</td>
</tr>
</tbody>
</table>


<p>A recent hack / sketchy 1st product draft required datasets that live in two different database to be joined together to do some analysis on. Initially thoughts of denormalization or key/value lookup crossed peoples minds but wanting a quick win to try and get the idea validated as quickly as possible, I kept on digging.</p>

<p>As always <a href="http://stackoverflow.com/questions/9493332/postgres-how-to-create-a-select-query-that-would-join-two-databases">stackoverflow</a> provided the start of the journey of discovery with something called dblink.</p>

<h2>dblink to the rescue!</h2>

<p><a href="http://www.postgresql.org/docs/current/interactive/contrib-dblink-function.html">dblink</a> is a hidden gem of a extension that made doing a join across two databases (weather there local or remote) a total breeze. Firstly the extension needs to be installed on the database with the following command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">CREATE</span> <span class="n">EXTENSION</span> <span class="n">dblink</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Once added to your database using it requires three pieces of information</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dblink</span><span class="p">(</span><span class="s1">&#39;CONNECTION STRING&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;QUERY STRING&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">AS</span> <span class="n">t</span><span class="p">(</span> <span class="n">CASTING</span> <span class="n">RESTULS</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Connection String</h2>

<p>I personally use this format of string as it allows easy access to both local and remote DBs.</p>

<pre><code>postgres://PG_USER:PG_PASSWORD@HOST:PORT/DATABSE_NAME'

eg

postgres://pguser:abcd@127.0.0.1:5432/test_db'
</code></pre>

<h2>Query String</h2>

<p>This is query you wish to run on the remote machine. It can be any valid SQL.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="s1">&#39;SELECT title, price, category FROM products WHERE shop_id = 99&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Casting the results</h2>

<p>When the results from the query are returned to local machine postgres doesn&rsquo;t know the column types of the received result set and thus needs to be told about them</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">title</span> <span class="nb">varchar</span><span class="p">,</span> <span class="n">price</span> <span class="nb">int</span><span class="p">,</span> <span class="n">category</span> <span class="nb">varchar</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Full call example</h2>

<p>So putting those three things together the final call would be</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dblink</span><span class="p">(</span><span class="s1">&#39;postgres://pguser:abcd@127.0.0.1:5432/test_db&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;SELECT title, price, category FROM products WHERE shop_id = 99&#39;</span><span class="p">)</span>
</span><span class='line'>   <span class="k">AS</span> <span class="n">t</span><span class="p">(</span><span class="n">title</span> <span class="nb">varchar</span><span class="p">,</span> <span class="n">price</span> <span class="nb">int</span><span class="p">,</span> <span class="n">category</span> <span class="nb">varchar</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Allowing you to manipulate this results just as it they were from a local database table.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-09-23T09:10:00+01:00" data-updated="true" itemprop="datePublished">Sep 23<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/vim/'>vim</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/09/23/vim-shortcuts/" itemprop="url">Vim Shortcuts</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<h2>Vim Commands</h2>

<p>i = insert mode</p>

<p>h,j,k,l = move left, up, down, left
w = move from word to word
b = move back word to word
W = jumps the whole word
B = jusmps back a word to word</p>

<p>$ = go to end of the line
^ = go to the begining of the line
0 = goes to the very beginning</p>

<p>gg = goes to the begginig of the file
G = goes to the bottom of the file
{ } = jumps paragraphs</p>

<p>f = finds the first occurence of a string in the file
F = fins the first occurance of a string backward</p>

<p>number followed by comman (4dd) &ndash; deletes four lines</p>

<p>3gg = goes 3 lines from the top
:13 = goes to line 13
3 G = goes three lines from the bottom</p>

<hr />

<h2>Advanced Movement</h2>

<p>ctrl d &ndash; moves half screen down
ctrl u &ndash; moves half screen up
ctrl f &ndash; full screen forward
ctrl b &ndash; full screen backward</p>

<p>M &ndash; goes to middle of the window
H &ndash; goes to top of window
L &ndash; goes to last line of window
3L &ndash; goes three lines above bottom of window</p>

<p>zt &ndash; moves the line our cursor is on to the top
zb &ndash; moves the line to the botton
zz &ndash; moves the line to the middle</p>

<p>ma &ndash; saves cursor position to a register
&lsquo;a &ndash; goes directly to register a
&rsquo; &ndash; move between markers</p>

<hr />

<h2>Basic Editing</h2>

<p>X &ndash; deletes behind the cursor
x &ndash; delete whats under the cursor
dd &ndash; delete the line
dw &ndash; delete the word
db &ndash; delete revious word</p>

<p>cc &ndash; delete line and enter insert mode
cw &ndash; delete work and enter insert mode
cd &ndash; delete previous word and enter insert mode</p>

<p>ci&#8221; &ndash; changes whats inbetween two &ldquo;
ca&rdquo; &ndash; deletes everything inside the quot and the quote</p>

<hr />

<h2>Cut, Copy and Paste</h2>

<p>Every deleteion is a cut command, puts in a special registar for pasting later</p>

<p>p &ndash; pastes last thing in deletion cut register
P &ndash; pastes before the cursor
y &ndash; yank/copy somehting copy can be used with any familiar command
yw &ndash; copy word
yy &ndash; copy line</p>

<hr />

<h2>Search</h2>

<p>/search = starts searching for word search. it is also case sensitive
?search = looks backwards for the word search
set incsearch = sets incremental search on
set ignorecase = turns of case senestive search
set hlsearch = turns on highlight search
nohlsearch / noh = turns off highlight search
n = searchs mores. vim stores the last search
c/find = will delete from the cursor to find and then enter insert mode</p>

<p>vim search can use regexs</p>

<hr />

<h2>Search and Replace</h2>

<p>:s/pattern/replace/flags
:s &ndash; perfoms a substitutions replaces on first occurance by defaul
:s/vim/Vim &ndash; replaces vim for Vim
:%s/vim/Vim &ndash; replaces whole file with vim for Vim
:%s/vim/Vim/g &ndash; replaces whole file with vim for Vim globally</p>

<p>vim will use previous serach pattern
so can do :s//pattern
when using regex can use \ze or \zs to stop selection before or af</p>

<p>Visual mode &ndash; v
visual line mode &ndash; V</p>

<p>gv &ndash; reslects last selection</p>

<p>go to a bracket, enter visual mode hit % and that will find the corresponding</p>

<p>FLAGS</p>

<p>c = confirm, asks for confirmation for oeach occurence
i = insensitive
g = finds all occurances in a line</p>

<p>HELP</p>

<p>:help s &ndash; opens the help for a command</p>

<hr />

<h2>Macros and Register</h2>

<p>ctrl g &ndash; get file in fo</p>

<p>macros store a command pipeline that can be used over and over</p>

<p>qa &ndash; start recording a macro in register a
q &ndash; stops recroding
:registers / reg &ndash; shows the recorded registers
@a &ndash; runs macro in a register
@@ &ndash; runts the last macro ran again</p>

<hr />

<h2>Command Line in Vim</h2>

<p>:! &ndash; initalises comman from the shell then run command
:read !date &ndash; puts the oupt of shell into the file under cursor
:r !curl &mdash;silent URL &ndash; outputs the file into the buffer
you can take the selected text buffer feed it in to standard in and replace it with output</p>

<hr />

<h2>Navigating Between Buffers</h2>

<p>:ls &ndash; lists all active buffers for files in memory
:bn / bnext &ndash; next buffer
:bp / bprev &ndash; previous buffer
:b# &ndash; last buffer we visited
:bf &ndash; first buffer</p>

<p>:bd 14 &ndash; deletes buffer 14</p>

<hr />

<h2>Windows and Tabs</h2>

<p>Split windows</p>

<p>:vsplit / vs file_path &ndash; splits the
ctrl+w h/l = move between left right
ctrl+w H / L = move to the left / right most part
ctrl + w J/K = move to the bottom / top
ctrl + w +/&ndash; = increase/decrease window hight 1 row
ctrl + w </> = increase/decrease width by 1 column
ctrl + w = = auto resize windows equally
:q = clost a window buffer</p>

<p>:sb 2 = split buffer in memory
:vert sb = vetical split buffer in memory</p>

<p>Tabs</p>

<p>:tab e / tabedit file_path
:gt &ndash; move oen tab forward
:gT &ndash; move one tab backward</p>

<hr />

<h2>Graphical Vim</h2>

<p>set gfn &ndash; sets current font</p>

<hr />

<h2>Indents and Folds </h2>

<p>:set list &ndash; prnts lines/tabs/space</p>

<blockquote><blockquote><ul>
<li>indent of one tab
8>> &ndash; indents following 8 lines</li>
</ul>
</blockquote></blockquote>

<p>:set expandtab &ndash; sets soft tabs
:set noexpandtab &ndash; sets tabs normal
:set shiftwidth=3 &ndash; 3 spaces for one indentation
:set smartindent &ndash; sets smart indentation
:set softtabstop / sts 3</p>

<p>in visual mode &ndash;</p>

<p>gv &ndash; reselects last selection</p>

<blockquote><p>/&lt; &ndash; indents</p></blockquote>

<p>Auto indent
= on select texted auto indent
=3j auto indent next 2 lines
=G indents the whole file</p>

<p>In inset mode
tab = inserts
ctrl + t = indent forward
ctrl + d = indent back</p>

<p>Folding</p>

<p>manual folds
zf5j &ndash; fold the next 5 lines
zo &ndash; open fold
zO &ndash; open from cursor fown
zc &ndash; close everything from position up fold
zd &ndash; delete fold
zf% &ndash; folds the matching bracket
zi &ndash; inverts folding on/off</p>

<p>auto folding</p>

<p>set foldmethod/fdm &ndash; numberous options see help foldmethod
set fdm=sytax = fold baed on syntax
set fdm=marker = set a custom folder maker } for instace</p>

<hr />

<h2>.vimrc File</h2>

<p>:so % &ndash; source our current file</p>

<p>set nocompatible &ndash; sets vims way of doing things</p>

<p>allows file types to be detected than plugins and indentation set up based on those files</p>

<p>filetype on
filetype indent on
filetype  plugin on</p>

<p>let VARIAABLE &ndash; &ldquo;.&rdquo;
syntax enable</p>

<p>set ignorecase
set hlsearch
set autoindent
set fileencoding=utf-8
set encoding=utf-8
set backspace=indent.eol.start</p>

<p>set smartcase &ndash; perform smart searchs
gdefault &ndash; perform global replacments
set incsearch
set showmatch &ndash; highlight all matching parentheses</p>

<p>deals with how windows are auto sized
set winwidth=84
set winheight=5
set winminheight=5
set winheight=999</p>

<p>set no/list &ndash; view all tabs and line endings
set guifont= &ndash; sets the font
set guioptions= add options
set guioptions-= remove options
set number &ndash; set line numbers
set visualbell &ndash; flash the screen over the bell
set cursoline &ndash; highlight line your in</p>

<p>set cc=80 &ndash; sets line at 80th column
set background=dark
colorschmeme solarized</p>

<p>au BufRead,BufNewFil *.ru setfiletype ruby</p>

<hr />

<h2>Mappings</h2>

<p>sequence of characters that triggers sequence of commands</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-28T19:05:00+01:00" data-updated="true" itemprop="datePublished">Aug 28<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/node-dot-js/'>node.js</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/08/28/removing-node-dot-js/" itemprop="url">Removing Node.js</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p>For when i cant find it, here is the best instructions i found for removing</p>

<ol>
<li>Go to /usr/local/lib and delete any node and node_modules</li>
<li>Go to /usr/local/include and delete any node and node_modules directory</li>
<li>If you installed with brew install node, then run brew uninstall node in your terminal</li>
<li>Check your Home directory for any &ldquo;local&rdquo; or &ldquo;lib&rdquo; or &ldquo;include&rdquo; folders, and delete any &ldquo;node&rdquo; or &ldquo;node_modules&rdquo; from there</li>
<li>Go to /usr/local/bin and delete any node executable</li>
</ol>


<p><a href="http://stackoverflow.com/questions/11177954/how-do-i-completely-uninstall-node-js-and-reinstall-from-beginning-mac-os-x">source</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-21T07:26:00+01:00" data-updated="true" itemprop="datePublished">Aug 21<span>st</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/chef/'>chef</a>, <a class='category' href='/blog/categories/ci/'>ci</a>, <a class='category' href='/blog/categories/ec2/'>ec2</a>, <a class='category' href='/blog/categories/jenkins/'>jenkins</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/08/21/setting-up-jenkins-with-chef-for-rails-project/" itemprop="url">Setting Up Jenkins With Chef for Rails Project</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p>There are numerous guides available on line for setting up a fresh install of Jenkins with numerous different configurations but i wanted to create a chef recipe that would give me a clean Jenkins install with my required project dependencies (excluding rvm) at the click of a button.</p>

<p>The reasons the excluding RVM in the chef process, even though the chef-rvm cookback is fantastic having used it before in the creation of a Rails stack is that i just could get system level RVM to play nice with Jenkins and user specific RVM (to the Jenkins user) to automatically install without asking for the Jenkins password. Better minds will probably be able to solve this issue but i opted for a different approach.</p>


		
		<a href="/blog/2013/08/21/setting-up-jenkins-with-chef-for-rails-project/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-08-09T16:32:00+01:00" data-updated="true" itemprop="datePublished">Aug 9<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/json/'>json</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/serialization/'>serialization</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/08/09/serilisation-preloading-and-simplecov/" itemprop="url">Serilisation, Preloading and SimpleCov</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://alisdair.mcdiarmid.org/2013/02/02/fixing-rails-auto-loading-for-serialized-objects.html">Alisdair McDiarmid</a>  has a great write up on solving the problems of serialising and deserializing custom objects to yaml in rails whilst in development and getting around the <code>ArgumentError: undefined class/module UnknownClass</code> error that are thrown due to classes not being loaded.</p>

<p>The solution is to eager load classes and reload them each request to make sure that when YAML deserialization occurs the classes are present as usually this process doesnt trigger the default lazy loading of classes in development.</p>

<figure class='code'><figcaption><span>The solution looks like this</span><a href='http://alisdair.mcdiarmid.org/2013/02/02/fixing-rails-auto-loading-for-serialized-objects.html'>Source</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Eager load all value objects, as they may be instantiated from</span>
</span><span class='line'><span class="c1"># YAML before the symbol is referenced</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">before_initialize</span> <span class="k">do</span> <span class="o">|</span><span class="n">app</span><span class="o">|</span>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">add</span> <span class="s1">&#39;app/values&#39;</span><span class="p">,</span> <span class="ss">:eager_load</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Reload cached/serialized classes before every request (in development</span>
</span><span class='line'><span class="c1"># mode) or on startup (in production mode)</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">to_prepare</span> <span class="k">do</span>
</span><span class='line'>    <span class="no">Dir</span><span class="o">[</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;app/values/*.rb&quot;</span><span class="p">))</span> <span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
</span><span class='line'>        <span class="n">require_dependency</span> <span class="n">file</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">require_dependency</span> <span class="s1">&#39;article_cache&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Testing, SimpleCov and Missed Coverage</h2>

<p>This solution was great, it solves the loading issue but during development I noticed the lines of code covered by SimpleCov was reduced, looking into know issues on the SimpleCov <a href="https://github.com/colszowka/simplecov/issues/107">github one explained</a> the reason why files where missing. The above solution of preloading the classes for deserialization means that the files are already loaded in memory before SimpleCov initialises and thus cant be tracked by Ruby&rsquo;s built in coverage mechanism.</p>

<h2>Solution</h2>

<p>As of rails 3.1, objects can be serialised to JSON as well as YAML. While it requires the addition of two methods to the class in question it does mean the class doesn&rsquo;t need to be preloaded and thus allows the code coverage to be tracked.</p>

<p>Adding the following two methods in your class and the additional JSON option to serialize in the model file allows for objects to be reinitialised based on the stored data parameters saved as JSON in the database.</p>

<figure class='code'><figcaption><span>in the model file </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">serialize</span> <span class="ss">:column_name</span><span class="p">,</span> <span class="no">JSON</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Serializing and Deserializing with JSON</span><a href='http://stackoverflow.com/questions/4569329/serialize-ruby-object-to-json-and-back'>source</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">json_create</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
</span><span class='line'>  <span class="kp">new</span><span class="p">(</span><span class="o">*</span><span class="n">o</span><span class="o">[</span><span class="s1">&#39;data&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span> <span class="s1">&#39;json_class&#39;</span> <span class="o">=&gt;</span> <span class="nb">self</span><span class="o">.</span><span class="n">class</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="nb">id</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">next_step</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-23T09:54:00+01:00" data-updated="true" itemprop="datePublished">Jul 23<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/chrome-extension/'>chrome extension</a>, <a class='category' href='/blog/categories/fun/'>fun</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/jquery/'>jquery</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/23/royal-baby-catifier/" itemprop="url">Royal Baby Catifier</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p>A quick, fun evening hacking up a Chrome extension. Sick of seeing articles about the royal baby? This extension removes the container and replaces it with a cat.</p>

<p><a href="https://chrome.google.com/webstore/detail/royal-baby-catifier/adjameoabcmbdobiafhhoclndepibfno">Chrome Web Store</a></p>

<p><img src="https://lh3.googleusercontent.com/0BF16NBbShToYIB8sSp49sKdFZR6wlWAQl8H7KN5_kEftx_3yvhJNCyPMOSF0RaBecRzTWrE3Q=s640-h400-e365-rw" alt="Cats" /></p>

<p><a href="https://github.com/jordanrs/royal-baby-catifier">Source</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-22T12:03:00+01:00" data-updated="true" itemprop="datePublished">Jul 22<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/hackathons/'>hackathons</a>, <a class='category' href='/blog/categories/philips-hue/'>philips hue</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/22/hacked-2013/" itemprop="url">Hacked 2013</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p><a href="http://hacked.io">Hacked.oi</a> was utterly awesome. In the end myself, <a href="https://twitter.com/marcelloseri">Marcello Seri</a> and <a href="https://twitter.com/b3noxley">Ben Oxley</a> created <a href="https://www.hackerleague.org/hackathons/hacked/hacks/homeflux">homeFlux</a>, a realtime system for adapting light levels to match a desired intensity and also adjust colour values over time much like <a href="http://justgetflux.com/">flu.x</a>. Was awesome fun.</p>

<iframe width="560" height="315" src="//www.youtube.com/embed/T_gPdTJkoM0" frameborder="0" allowfullscreen></iframe>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-07-10T20:46:00+01:00" data-updated="true" itemprop="datePublished">Jul 10<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/active-admin/'>active admin</a>, <a class='category' href='/blog/categories/javascript/'>javascript</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/xhr/'>xhr</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/07/10/activeadmin-form-preview-with-javascript-formdata/" itemprop="url">ActiveAdmin Form Preview With Javascript FormData</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p>One of my recent tasks has been to build a preview of a form submission into an existing application. Having done something similar in the past involving changing the forms action with javascript, ajax posting the form (including images), generating a preview, changing the form back blaa blaa blaa blaa blaaaaa. I wanted to find a cleaner way to a) deal with the preview and b) ajaxing blob data (image/files) and thanks to not having to support IE implemented the following procedure using FormData and XMLHttpRequest 2.</p>


		
		<a href="/blog/2013/07/10/activeadmin-form-preview-with-javascript-formdata/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-06-01T10:27:00+01:00" data-updated="true" itemprop="datePublished">Jun 1<span>st</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/capybara/'>capybara</a>, <a class='category' href='/blog/categories/facebook/'>facebook</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/testing/'>testing</a>


</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/06/01/testing-facebook-login-and-permissions-with-capybara/" itemprop="url">Testing Facebook Login and Permissions With Capybara</a></h1>
	<h2 class="sub_heading" itemprop="name"></h2>
	<div class="entry-content" itemprop="articleBody">
		<p>Having begun to use Capybara and Rspec quiet heavily there have been a few challenges that need to be overcome. One of these is that the applications I develop day to day are heavily intertwined with Facebook and user flow relies heavily on Facebook login and accepting permissions at various points throughout the application.</p>


		
		<a href="/blog/2013/06/01/testing-facebook-login-and-permissions-with-capybara/" class="more-link">Read on &rarr;</a>
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-05-26T00:00:00+01:00" data-updated="true" itemprop="datePublished">May 26<span>th</span>, 2013</time></div>
		<div class="tags">

</div>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/05/26/Learning-Chef-From-Scratch---Building-a-EC2-backed-Rails-Stack-Part-1/" itemprop="url">Learning Chef From Scratch - Building a EC2 Backed Rails Stack Part 1</a></h1>
	<h2 class="sub_heading" itemprop="name">Setup Chef and Creating a EC2 instance</h2>
	<div class="entry-content" itemprop="articleBody">
		<p>Chef is a fantastic tool for automating the process bootstrapping a fresh server so that once you have got it running how you want, replicating that configuration and setup requires very little effort what so ever.</p>

<p>Chef has two different use cases, Chef server (wether that be hosted or private) or Chef Solo. Chef solo allows you to interact directly with the machine your wanting to administrate and is very useful for bootstrapping a vagrant image for instance. Chef Server offers a centralised place for you to push your configurations and recipes so that when working with multiple servers (known as nodes or chef clients) you don&rsquo;t have to update each one individually as each client can be set to poll to server for any updates.</p>

<p>For my first time using chef i through myself straight in at the deep end in that i wanted to put together a full working EC2 instance that would run my usual heroku stack (nginx, unicorn, ruby, rails and postgres). I opted for using Opscodes free Chef hosted plan for my Chef server and got straight to it.</p>


		
		<a href="/blog/2013/05/26/Learning-Chef-From-Scratch---Building-a-EC2-backed-Rails-Stack-Part-1/" class="more-link">Read on &rarr;</a>
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2014 - Jordan Rogers-Smith -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'jordanrs-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






		</div>
	</div>
</body>
</html>
